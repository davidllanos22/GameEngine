/*! GameEngine 2015-05-18 */
Camera=function(a,b){this.setPosition=function(a,b,c){var d=new Math.Vector2(a,b);c?this.position.lerp(d,.01):this.position=d,this.useLimit&&(this.position.x<0&&(this.position.x=0),this.position.y<0&&(this.position.y=0),this.position.x>this.limit.x&&(this.position.x=this.limit.x),this.position.y>this.limit.y&&(this.position.y=this.limit.y)),this.rect.position=this.position},this.setRotation=function(a){this.angle=a},this.shake=function(a,b){if(!this.shaking){var c=this,d=this.position.copy(),e=this.angle;this.shakeTimer=new Timer(a,!1,null,function(){var a=Math.randomRange(-b,b);c.setPosition(c.position.x-a,c.position.y-a,!1)},function(){c.position=d,c.angle=e,c.shaking=!1}),this.shakeTimer.start(),this.shaking=!0}},this.game=a,this.name=b,this.position=new Math.Vector2(0,0),this.size=new Math.Vector2(a.width/2/a.gameScale,a.height/2/a.gameScale),this.rect=new Rectangle(0,0,this.size.x,this.size.y),this.angle=0,this.shaking=!1,this.limit=new Math.Vector2(0,0),this.useLimit=!1},Entity=function(a,b,c){this.position=new Math.Vector2(a,b),this.name=c,this.parent,this.sprite,this.rect,this.childs=new Array,this.game,this.init()},Entity.prototype={init:function(){},setPosition:function(a,b){this.position.x=a,this.position.y=b},onScreen:function(){return null!=this.rect?this.rect.collides(game.currentCamera.rect):void 0},add:function(){},remove:function(){},remove:function(){},destroy:function(){this.game.currentScene.remove(this)},render:function(){},update:function(){}},Rectangle=function(a,b,c,d){this.setPosition=function(a,b){this.position.x=a,this.position.y=b},this.setSize=function(a,b){this.size.x=a,this.size.y=b},this.collides=function(a){return null!=a?this.position.x<a.position.x+a.size.x&&this.position.x+this.size.x>a.position.x&&this.position.y<a.position.y+a.size.y&&this.position.y+this.size.y>a.position.y:void 0},this.collidesAt=function(a,b,c){var d=this.copy();return d.position.addX(b),d.position.addY(c),d.collides(a)},this.copy=function(){return new Rectangle(this.position.x,this.position.y,this.size.x,this.size.x)},this.position=new Math.Vector2(a,b),this.size=new Math.Vector2(c,d)},Font=function(a,b,c,d,e){this.chars=b||"ABCDEFGHIJKLMNOPQRSTUVWXYZ      0123456789      !?.;:,-         ",this.w=c||16,this.h=d||20,this.separation=e||16,a?this.img=a:(this.img=new Image,this.img.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAACACAYAAADktbcKAAAIbUlEQVR4Xu2d0XalIAxF2///6E6nra57FYWcBCG653HWjZCdcAig9PODfxCAwGMJfD7WcxyHAAQ+EACSAAIPJoAAPDj4uA6B/wLw1YjhSCxmt6+J3Oz9X8KTlf+o/tfivvSrNf5HftTsa/2o2XflhwDcXwC7JtDEE0ht4CEA3wRWAfj6KgvR5+fK8XQGms3+pd9NA2C2/q+dNvJf/F78yRY/b/8b/N0WvD+JfxT/Qhy2+VS0z5J/CMBfBYAAzDEBIADv+tQgaKcCVrPfCUBUANQZqKCcphk8qv+FfZGmCiiq/972rfzXevivErTOYLtpdf8cEz9r/w2/P60AjvLn5PlvAzAq/wz+uNpHADYVwCwDGAH4rUhqM9iyB2EYMAjAC4FuSwDrDNI7gH/7HaUDD1cJtU3AbQNqAht4ePv/thlmaLfE8mc5/bqmtvrfsOZuGsAn8W6y33LIUgFY8w8BmGwPwFtCWhPg5ffWgYsA/BJwleDR9tb4swSYdAlgmIlDEnAtA+6zB7AbCweK1cQvSwVgXcIiAAjA2/Z/IdHXqvxsAO3q6vGbgAjAO4HiJmy4AFhLkOg1tHcN6e1/w5r3dA0a1b5aQXjb9/IfsASaqgLw8rfmHwIQvAdgDUC0AI4eQAjA70Q7SoCt+cerwP1eBY5+FTXrtwA1DkPfhV8E+GhH8+T/F79m7X+N+49rCAAC0DuBa4nYu31pD6NBEG4jAA2+8hMIQOCOBGrqfEef8QkCEPgjgACQChB4MAEE4MHBx3UIIADkAAQeTAABeHDwcR0CTzgGjDoGGn0Ov83W2Y+hjvrLqJuIAALQ7z2A1gHQeg6OAEw0cO7SlW6fA6/TrvFOu12WX2zvfZW2l32Wr9GE+N1lLKX0AwGY7Hvu7FdSIQC5dCD8Y6CoGbCAsWkNrn7OargBZtu1pq/Jvo1cd+LNXgHsoLR/DpxrxNystwgAFUCIgCEAOZUhXAAKa/+mXXjHtdzL89UrrUIGQO8KolYBrBDEG30c/KPuJMw5gpL3GgG4SQWAACQfiYO6Hy4A6h5AQAn56ArAW4FECYj1TrpBeU+zfwQQgJtUAAgAY1ohEH4MqFYAjjVo6B6AcIwVcqlm1N+mE/iP5qfkLTZBBBCAoDsBo0roo7ie/KEV7yYmAhA0mDI+ZvcqsHqO3uB80zn+yXNqHy4dvVKr2u2KgYqPvds/Ok1pfZVY5aDaWfk1pBA/iSaAAPi/BXibQQsBihpACEB09vO8t7fT1BkMjBCAQFICr7MTApA0iHQbAiqBWnmqPhc7CEAgAQEEIEGQ6CIEehFAAHqR5bkQSEAAAUgQJLoIgV4ErrgSrCYy3nPsu9rXuNWOH7c50+s9DC//XrnNcxsIIAD+9wC8A8B7+tKr/asEpCFN+UkvAuGvAi8dNfyZYu/35KH2wrv0Xdr/5miqABzfUoT2f6ca9Tsde+U2z20ggAAEfw0oDAD1M+a3JQAC0JDt/GRHIOxz4DUb7XfBFUvYkxtwtk6E2Hs/pz35hmItig7y70gAXCW4lV+0/4b2GZYDCSAAwRWAcCEGAjBwADy96QgBKJaiWfcAvCX8APtiRWSYgdkDeLAKIABB9wEMXIMjAA8ewF7XIwQg9EYctYTejYL2vYiQPQRv+441eKgAqKcgDv+9OYy9gwACcPAegLWEdgyAqBt91KWYt32vgDrSF1MvgW7HgOvWd/0ceLY1qPVY7un991Yg3hzG3kEAAdjDQwBemBg2c9UKxJG+mHoJXPEq8FoMHHR29KusxRms0Ncs79JbXy328vfy8+Yw9g4CCMBBBYAA7AiYXk028HOkL6ZeAq1B9baDPQQgMCEBBGDCoNAlCFxFAAG4ijTtQGBCAgjAhEGhSxC4igACcBVp2oHAhAQQgAmDQpcgcBWBs2PAVnGIPke2+m49994+32tv7S+/h8A0BBCA4zsBWwVwmmDSEQhYCRx+DPT9oNYB4H0X3trn4gxu+Hgn2t7bf+whMIwAAnBwI5BBAIcFj4Yh4CUQJgC7abX9e3yvD941vNfe23/sITCMAALAHsCw5KPh8QQiBGDxona5Zeuewngq1/ag9RRl6RUcr43PrVtDAMaHFwEYH4PH9iDiGPCtAiiQrM1Y3jX4LeyPLhVdp/36zUqPTWIc1wkgAP49gBABQgD0JMZSJ3DFEqCpAhh4jm+9Amx34PH/P7z9N4SwxtPwKH76dAIIgP89gBABMSQiAmCAxU/PCdxmCdBhBm4daF4BIEchMIwAAhC0B+AQoGHBp2EItM5yM5PybsJ5fRvdvrf/2D+YAALgDz4C4GfIEwYRuIMADEJHsxDITwAByB9DPICATAABkNFhCIH8BBCA/DHEAwjIBBAAGR2GEMhPAAHIH0M8gIBMAAGQ0WEIgfwEEID8McQDCMgEEAAZHYYQyE8AAcgfQzyAgEwAAZDRYQiB/AQQgPwxxAMIyAQQABkdhhDITwAByB9DPICATAABkNFhCIH8BBCA/DHEAwjIBBAAGR2GEMhPAAHIH0M8gIBMAAGQ0WEIgfwEEID8McQDCMgEEAAZHYYQyE8AAcgfQzyAgEwAAZDRYQiB/AQQgPwxxAMIyAQQABkdhhDITwAByB9DPICATAABkNFhCIH8BBCA/DHEAwjIBBAAGR2GEMhPAAHIH0M8gIBMAAGQ0WEIgfwEEID8McQDCMgEEAAZHYYQyE8AAcgfQzyAgEwAAZDRYQiB/AQQgPwxxAMIyAQQABkdhhDITwAByB9DPICATAABkNFhCIH8BBCA/DHEAwjIBBAAGR2GEMhPAAHIH0M8gIBMAAGQ0WEIgfwEEID8McQDCMgEEAAZHYYQyE8AAcgfQzyAgEwAAZDRYQiB/AQQgPwxxAMIyAT+AU7zkvk8QLH1AAAAAElFTkSuQmCC"),this.render=function(a,b,c,d){for(var e=0;e<this.chars.length;e++)if(this.chars.charAt(e)==a.toUpperCase()){var f=e%16,g=Math.floor(e/16);d.imageSection(this.img,b,c,f,g,this.w,this.h,this.w,this.h)}}},Game=function(a,b,c){var d=function(a){a.loader=new Loader,a.graphics=new Graphics(a),a.input=new Input(a),a.timerManager=new TimerManager(a);var b=new Scene(a,"Loading");b.render=function(){a.graphics.setClearColor("#0d4c57");var b="Loading: "+a.loader.numResourcesLoaded+" of "+a.loader.numResources;a.graphics.print(b,a.getSize().x/2-16*b.length/2,a.getSize().y/2)},a.currentScene=b,a.currentCamera=new Camera(a,"Default Camera"),a.loader.onFinish(function(){a.currentScene.changeScene(new Scene(a,"Default Scene")),a.graphics.setClearColor("#000"),a.init(),originalWidth=w.x,j(a)}),t=(new Date).getTime(),v=new Date,e(a)},e=function(a){var b=(new Date).getTime(),c=b-t,d=new Date;for(r=1e3/(d-v)|0,v=d,s+=Math.min(1,c/1e3);s>u;)s-=u,f(a);g(a),window.requestAnimationFrame(function(){e(a)})},f=function(a){a.loader.loaded||a.loader.check(),(!o||n)&&(a.timerManager.update(),a.loader.loaded&&a.update(),a.currentScene.updateInternal(),a.input.gamepad&&(a.input.gamepad=navigator.getGamepads&&navigator.getGamepads()[0]),a.input.mouseReset())},g=function(a){C?(m.imageSmoothingEnabled=!1,m.mozImageSmoothingEnabled=!1,m.msImageSmoothingEnabled=!1):(m.imageSmoothingEnabled=!0,m.mozImageSmoothingEnabled=!0,m.msImageSmoothingEnabled=!0),a.graphics.clear(),a.graphics.renderCounter=0,m.save(),m.scale(y,y),m.translate(Math.floor(-a.currentCamera.position.x),Math.floor(-a.currentCamera.position.y)),m.rotate(a.currentCamera.angle*Math.PI/180),a.currentScene.renderInternal(),a.loader.loaded&&a.render(),a.input.mouseRender(),m.restore(),o&&!n&&(a.graphics.rect(0,0,a.getSize().x,a.getSize().y,"rgba(0,0,0,0.4)"),a.graphics.print("- PAUSED - ",a.getSize().x/2-80,a.getSize().y/2-10)),p&&a.graphics.print("FPS: "+r,8,8)};this.init=function(){},this.render=function(){},this.update=function(){};var h=function(a){n=!0,a.onFocus()},i=function(a){n=!1,a.onBlur()},j=function(a){if(x)a.setSize(window.innerWidth,window.innerHeight);else if(A){B=w.x/w.y;var b=window.innerWidth/B,c=b/B;c>window.innerHeight&&(c=window.innerHeight,b=c*B),c<window.innerHeight&&(c=window.innerHeight,b=c*B),b>window.innerWidth&&(b=window.innerWidth,c=b/B),z=b/originalWidth,z*=y,a.setSize(Math.floor(b),Math.floor(c)),m.scale(z,z)}};this.onFocus=function(){},this.onBlur=function(){},this.onResize=function(){},this.setSize=function(a,b){(0==a||0==b)&&Utils.logErr("Width and Height can't be 0."),w.x=a,w.y=b,l.width=a,l.height=b,l.style.width=a,l.style.height=b},this.setScale=function(a){y=a>0?a:0},this.getScale=function(){return y},this.getSize=function(){var a=w.x/z/y,b=w.y/z/y;return new Math.Vector2(a,b)},this.getFps=function(){return r},this.fillScreenWithRatio=function(a){return null==a?A:void(A=a)},this.fillScreen=function(a){return null==a?x:void(x=a)},this.showPauseWhenNotFocused=function(a){return null==a?o:void(o=a)},this.showFps=function(a){p=a},this.add=function(a){this.currentScene.add(a)},this.remove=function(a){this.currentScene.remove(a)},this.removeAll=function(){this.currentScene.removeAll()},this.changeScene=function(a){this.currentScene.changeScene(a)},this.getCanvas=function(){return l},this.getContext=function(){return m};var k=!1,l=document.createElement("canvas"),m=null;l.tabIndex=1,l.style.outline="none",k?(this.gl=this.cvs.getContext("experimental-webgl")||this.cvs.getContext("webgl"),console.log(this.gl),this.gl.canvas.width=2*a,this.gl.canvas.height=2*b,this.gl.viewport(0,0,a,b),this.gl.clearColor(1,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)):m=l.getContext("2d"),void 0!=c?c.appendChild(this.cvs):document.body.appendChild(l);var n=!0,o=!1;n&&l.focus();var p=!1,q=60,r=0,s=0,t=0,u=10/q,v=0,w=new Math.Vector2(a,b),x=!1,y=1,z=1,A=!1,B=0,C=!0;this.setSize(a,b);var D=this;l.onfocus=function(){h(D)},l.onblur=function(){i(D)},window.onresize=function(){j(D)},l.oncontextmenu=function(a){a.preventDefault()},d(this)},Graphics=function(a){this.point=function(a,b,c){this.setColor(c),this.ctx.fillRect(a,b,1,1),this.renderCounter++},this.line=function(a,b,c,d,e){this.setColor(e),this.ctx.beginPath(),this.ctx.moveTo(a,b),this.ctx.lineTo(c,d),this.ctx.stroke()},this.rect=function(a,b,c,d,e){this.setColor(e),this.ctx.fillRect(a,b,c,d),this.renderCounter++},this.circle=function(a,b,c,d){this.setColor(d),this.ctx.beginPath(),this.ctx.arc(a,b,c,0,2*Math.PI,!1),this.ctx.fill()},this.setClearColor=function(a){this.clearColor=a},this.clear=function(){this.rect(0,0,this.game.getSize().x*this.game.getScale(),this.game.getSize().y*this.game.getScale(),this.clearColor)},this.print=function(a,b,c,d){for(null!=d&&(this.ctx.save(),this.ctx.scale(this.game.getScale()-(this.game.getScale()-d),this.game.getScale()-(this.game.getScale()-d))),i=0;i<a.length;i++)this.font.render(a.charAt(i),b+this.font.separation*i,c,this);null!=d&&this.ctx.restore(),this.renderCounter++},this.setColor=function(a){this.ctx.strokeStyle=a,this.ctx.fillStyle=a},this.setFont=function(a){this.font=a},this.image=function(a,b,c){b=Math.floor(b),c=Math.floor(c),this.ctx.drawImage(a,0,0,a.width,a.height,b,c,a.width,a.height),this.renderCounter++},this.imageSection=function(a,b,c,d,e,f,g,h,i){b=Math.floor(b),c=Math.floor(c),d=Math.floor(d),e=Math.floor(e),h=Math.floor(h),i=Math.floor(i),0>h&&(h=0),0>i&&(i=0),this.ctx.drawImage(a,d*f,e*g,f,g,b,c,h,i),this.renderCounter++},this.imageSectionRot=function(a,b,c,d,e,f,g,h,i,j){b=Math.floor(b),c=Math.floor(c),d=Math.floor(d),e=Math.floor(e),h=Math.floor(h),i=Math.floor(i),0>h&&(h=0),0>i&&(i=0),this.ctx.save(),this.ctx.translate(b+h/2,c+i/2),this.ctx.rotate(j),this.ctx.drawImage(a,d*f,e*g,f,g,-h/2,-i/2,h,i),this.ctx.restore(),this.renderCounter++},this.game=a,this.ctx=this.game.getContext(),this.renderCounter=0,this.clearColor="#000000",this.font=new Font},Keys={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,NUM_0:48,NUM_1:49,NUM_2:50,NUM_3:51,NUM_4:52,NUM_5:53,NUM_6:54,NUM_7:55,NUM_8:56,NUM_9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,PLUS:187,MINUS:189},Input=function(a){this.onKeyDown=function(a){this.keyDown[a.keyCode]=!0,0!=this.keyJustDown[a.keyCode]&&(this.keyJustDown[a.keyCode]=!0),delete this.keyJustReleased[a.keyCode]},this.onKeyUp=function(a){0!=this.keyJustReleased[a.keyCode]&&(this.keyJustReleased[a.keyCode]=!0),delete this.keyDown[a.keyCode],delete this.keyJustDown[a.keyCode]},this.check=function(a){return this.keyDown[a]},this.pressed=function(a){return this.keyJustDown[a]?(this.keyJustDown[a]=0,!0):!1},this.released=function(a){return this.keyJustReleased[a]?(this.keyJustReleased[a]=0,!0):!1},this.onMouseMove=function(a,b){var c=this.game.getCanvas().getBoundingClientRect(),d=(b.clientX-c.left)/(c.right-c.left)*this.game.getSize().x,e=(b.clientY-c.top)/(c.bottom-c.top)*this.game.getSize().y;this.mouse.x=d,this.mouse.y=e},this.onMouseDown=function(a,b){this.mouseClick[b.button]=!0,this.mouseHold[b.button]=!0},this.onMouseUp=function(a,b){this.mouseRelease[b.button]=!0,this.mouseHold[b.button]=!1},this.mouseReset=function(){this.mouseClick=[!1,!1,!1],this.mouseRelease=[!1,!1,!1]},this.mouseRender=function(){null!=this.cursorImage&&(this.cursorImage instanceof Image&&this.game.graphics.image(this.input.cursorImage,this.game.input.mouse.x,this.game.input.mouse.y),this.game.input.cursorImage instanceof Animation)},this.setCursorStyle=function(a){this.game.getCanvas().style.cursor=a},this.setCursorImage=function(a){this.setCursorStyle("none"),this.cursorImage=a},this.game=a,this.cvs=a.getCanvas(),this.keyDown={},this.keyJustDown={},this.keyJustReleased={},this.mouse=new Math.Vector2(0,0),this.mouseClick=[!1,!1,!1],this.mouseRelease=[!1,!1,!1],this.mouseHold=[!1,!1,!1],this.cursorImage,this.gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads,this.gamepad=navigator.getGamepads&&navigator.getGamepads()[0];var b=this;this.cvs.onkeydown=function(a){b.onKeyDown(a)},this.cvs.onkeyup=function(a){b.onKeyUp(a)},this.cvs.onmousemove=function(a){b.onMouseMove(this,a)},this.cvs.onmousedown=function(a){b.onMouseDown(this,a)},this.cvs.onmouseup=function(a){b.onMouseUp(this,a)}},Loader=function(){this.loadImage=function(b){var c=new Image;return c.src=b+"?"+(new Date).getTime(),this.numResources++,c.onload=function(){console.log("Image loaded "+b),a.numResourcesLoaded++,a.check()},c},this.loadSound=function(b){var c=new Audio;return c.src=b+"?"+(new Date).getTime(),this.numResources++,c.addEventListener("loadeddata",function(){console.log("Audio loaded "+b),a.numResourcesLoaded++,a.check()},!1),c},this.loadData=function(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(console.log("Data loaded "+a),b(c.responseText))},c.open("GET",a,!0),c.send()},this.onFinish=function(a){this.onFinish=a},this.check=function(){this.numResourcesLoaded==this.numResources&&(this.loaded=!0,this.onFinish())};var a=this;this.resources=[],this.numResources=0,this.numResourcesLoaded=0,this.onFinish,this.loaded=!1},Scene=function(a,b){this.add=function(a){a.game=this.game,this.childs.push(a)},this.remove=function(a){this.childs.splice(this.childs.indexOf(a),1)},this.removeAll=function(){for(var a=this.childs.length;a>0;)this.remove(this.childs[0]),a=this.childs.length},this.changeScene=function(a){this.game.currentScene=a},this.renderInternal=function(){this.render();for(var a=0;a<this.childs.length;a++)this.childs[a].render()},this.updateInternal=function(){this.ySorting&&this.childs.sort(function(a,b){var c=Math.ceil(a.position.y),d=Math.ceil(b.position.y);return c-d});for(var a=0;a<this.childs.length;a++)this.childs[a].update();this.update()},Entity.call(this,0,0,"Scene"),this.name=b,this.game=a,this.ySorting=!0,this.init()},Scene.prototype=Object.create(Entity.prototype),Scene.prototype.constructor=Scene,TransitionScene=function(a,b){this.render=function(){this.visible.renderInternal(),this.fadeIn.isRunning?this.game.graphics.rect(0,0,this.game.getSize().x,this.game.getSize().y,"rgba(255,255,255,"+this.fadeIn.time/this.time+")"):this.game.graphics.rect(0,0,this.game.getSize().x,this.game.getSize().y,"rgba(255,255,255,"+(this.time-this.fadeOut.time)/this.time+")")},Scene.call(this,b.game,"Transition Scene");var c=this;this.from=a,this.to=b,this.visible=this.from,this.time=300,this.fadeOut=new Timer(this.time,!1,null,null,function(){this.game.currentScene.changeScene(b)}),this.fadeIn=new Timer(this.time,!1,null,null,function(){c.visible=b,b.init(),c.fadeOut.start()}),this.fadeIn.start()},TransitionScene.prototype=Object.create(Scene.prototype),TransitionScene.prototype.constructor=TransitionScene,Animation=function(a,b,c,d){this.frames=d,this.w=b,this.h=c;var e=this;this.actualFrame=0,this.timer=new Timer(a,!0,null,null,function(){e.actualFrame==e.frames.length-1?e.actualFrame=0:e.actualFrame++}),this.timer.start()},Animation.prototype={render:function(a,b,c,d,e,f){game.graphics.imageSectionRot(a,b,c,this.frames[this.actualFrame][0],this.frames[this.actualFrame][1],this.w,this.h,d,e,f)}},Math.lerp=function(a,b,c){return(b-a)*c},Math.randomTo=function(a){return Math.floor(Math.random()*(a+1))},Math.randomRange=function(a,b){return Math.randomTo(b-a)+a},Math.Vector2=function(a,b){void 0==a&&void 0==b&&(a=0,b=0),this.x=a,this.y=b,this.set=function(a,b){this.x=a,this.y=b},this.add=function(a){return this.x+=a.x,this.y+=a.y,this},this.addX=function(a){return this.x+=a,this},this.addY=function(a){return this.y+=a,this},this.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},this.subtractX=function(a){return this.x-=a,this},this.subtractY=function(a){return this.y-=a,this},this.reverse=function(){return this.x=-this.x,this.y=-this.y,this},this.dotProduct=function(a){return this.x*a.x+this.y*a.y},this.crossProduct=function(a){return this.x*a.y-this.y*a.x},this.lerp=function(a,b){return this.x+=Math.lerp(this.x,a.x,b),this.y+=Math.lerp(this.y,a.y,b),this},this.angleBetween=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.distance=function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},this.copy=function(){return new Math.Vector2(this.x,this.y)}},StateMachine=function(){this.add=function(a){this.find(a)?console.log("There is already an state with that name."):this.states.push(a)},this.remove=function(a){this.find(a)?this.states.splice(this.states.indexOf(a),1):console.log("No state with that name.")},this.set=function(a){this.find(a)?(this.last=this.current,this.current=a):console.log("No state with that name.")},this.find=function(a){for(var b=!1,c=0;c<this.states.length&&!b;)this.states[c]==a&&(b=!0),c++;return b},this.states=[],this.current="",this.last=""},Timer=function(a,b,c,d,e){this.start=function(){game.timerManager.add(this),this.reset()},this.run=function(){(!this.done||this.repeat)&&(-1==this.time?(null!=this.onStart&&this.onStart(),this.time++):this.time==this.duration?(null!=this.onFinish&&this.onFinish(),this.done=!0,this.isRunning=!1,this.repeat?(this.count++,this.reset()):game.timerManager.remove(this)):(null!=this.onTick&&this.onTick(),this.time++))},this.reset=function(){this.time=-1,this.done=!1,this.isRunning=!0},this.pause=function(){this.isRunning=!1},this.unpause=function(){this.isRunning=!0},this.duration=a,this.isRunning=!1,this.repeat=b,this.onStart=c,this.onTick=d,this.onFinish=e,this.game,this.time=-1,this.count=0,this.done=!1},TimerManager=function(a){this.add=function(b){-1==this.timers.indexOf(b)&&(b.game=a,this.timers.push(b))},this.remove=function(a){this.timers.splice(this.timers.indexOf(a),1)},this.update=function(){for(var a=0;a<this.timers.length;a++)this.timers[a].isRunning&&this.timers[a].run()},this.game=a,this.timers=[]},Utils={},Utils.getScreenShoot=function(a){var b=a.getCanvas().toDataURL();return window.open(b,"_blank"),b},Utils.getBase64Image=function(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");return c.drawImage(a,0,0),b.toDataURL("image/png")},Utils.playSound=function(a){a=a.cloneNode(),a.play()},Utils.stopSound=function(){},Utils.loopSound=function(a){a.loop=!0,a=a.cloneNode(),a.play()};